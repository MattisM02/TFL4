# 1) Build stage: native image bauen
FROM ghcr.io/graalvm/native-image-community:21 AS builder

WORKDIR /workspace

# Maven Wrapper + pom kopieren (f체r Dependency caching)
COPY .mvn .mvn
COPY mvnw mvnw
COPY pom.xml pom.xml

# Quellen kopieren
COPY src src

# Native build (Spring Boot 4 kann das 체ber AOT)
RUN ./mvnw -DskipTests -Pnative package

# 2) Runtime stage: kleine Laufzeit
FROM debian:bookworm-slim

WORKDIR /app

# Das erzeugte Binary (Name h채ngt vom Build ab)
# H채ufig: target/<artifactId>
COPY --from=builder /workspace/target/jvm-optim-demo /app/app

EXPOSE 8080
ENTRYPOINT ["/app/app"]

# Native Image bauen:
# cd C:\Users\matti\IdeaProjects\TFL4\ResourcenOptimierung_TFL4
# docker build -t tfl4-native -f docker/graalvm/Dockerfile .